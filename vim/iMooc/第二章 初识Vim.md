# 第二章 初识Vim

## 2-1 初识Vim，vim的模式

### Normal模式

在编辑模式下，可以使用`ESC`进入Normal模式。

使用`：wq`，可以保存并退出。

### 编辑模式(insert)

Normal模式下:

按**`i`**进入编辑模式，在光标前插入（insert）

按**`I`**进入编辑模式，在当前行首插入（insert before line）

按**`o`**进入编辑模式，在下一行插入（open a liine below)

按**O**进入编辑模式，在上一行插入（open a liine above)

按**`a`**进入编辑模式，在光标后插入（append）

按**`A`**进入编辑模式，在当前行后插入（append after line）

## 2-2 Vim，为什么有这么多模式

### Normal（普通）模式

- 进入Vim默认使用的是Normal模式，使用Esc从插入模式回到Normal模式

- 普通模式下可以进行各种命令操作和移动

- 大部分情况是在浏览而不是编辑，所以Vim默认模式是Noraml

### Insert（插入）模式

- 使用`i（inster），a（append），o（open a line below）`进入插入模式

- 使用Esc退出插入模式到Normal模式

### Command（命令）模式

- 执行Vim命令，比如保存`:w`，退出`:q`

- 使用分屏`:vs（vertical split）竖分屏，:sp（split）`

- 使用`:% s/foo/bar/g`全局替换

- 使用`:set nu设置行号`

### Visual（可视）模式

Visual模式一般用来块状选择文本

- Normal模式下使用v进入Visual选择

- 使用`v/V`选择行

- 使用`ctrl+v`进行方块选择

## 2-3 Vim编辑技巧

### 如何快速纠错

- 进入插入模式后，ctrl+h删除上个字符，ctrl+w删除上个单词，ctrl+u删除当前行

- 以上命令在终端上通用，ctrl+b前移光标，ctrl+f后移光标，ctrl+a移动到开头，ctrl+e移动到结尾。

### 快速切换insert和Normal模式

- 可以使用Ctrl+c代替Esc（但是可能会中断某些插件）或者ctrl+[

- gi快速跳转到最后一次编辑的地方并进入插入模式

- 可以使用映射代替Esc

### 让键盘适应工具

- 选择Esc和Ctrl比较容易碰到的键盘

- 使用hhkb或者Poker2这种迷你键盘

- 使用软件修改键位，比如CapsLock改成频繁使用到的Ctrl

### 孰能生巧-如何练习

让肌肉形成记忆

- Linux和Vim下有非常多的快捷键简化工作

- 尝试抛弃你的退格键，使用Ctrl快捷键来完成编辑删除工作

- 尝试修改而不是强迫自己适应难用的键位设置

## 2-4 Vim快速移动大法

### 反人类的hjkl

众所周知，vim的Normal模式使用了反人类的hjkl来移动

- 据说编辑器的作者在编写Vim的时候键盘还没有流行上下左右按键

- 左（h），下（j），上（k），右（l），移动也不会让手指脱离主键区

- 逼着自己使用hjkl后一段时间后，会发现他非常的有效率

### 在单词间飞舞

- w/W移动到下一个word/WORD开头。e/E下一个word/WORD尾

- b/B回到上一个word/WORD开头，可以理解为backword

- word指的是一**非**空白分隔符分割的单词，WORD以空白分隔符分割的单词

### 行间搜索移动

同一行快速移动的方式其实是搜索一鞥字符并且移动到该字符

- 使用`f{char}`可以移动到char字符上，t移动到char的前一个字符

- 如果第一次没搜到，可以用分号（;）/逗号（,）继续搜索该行下一个/上一个

- 大写的F表示反过来搜索前面的字符

### Vim水平移动

- 0移动到行首第一个字符，^移动到第一个非空白字符

- $移动到行尾，g_移动到行尾非空白字符

- 记住常用的0和$就可以满足日常需求了

### Vim垂直移动

可以在句子（sentence）和段落（paragraph）间移动（不常用）

- 使用（）括号在句子间移动，可以使用:help (来查看帮助

- 使用{}在段落之间移动

### Vim页面移动

翻页命令太多，2/8定律，记住常见的就能满足需求

- gg/G移动到开头和结尾，可以使用Ctrl+o快速返回

- H/M/L跳转到屏幕的开头（Head），中间（Middle）和结尾（Lower）

- Ctrl+u和Ctrl+f上下翻页，（upword/forward)，zz把屏幕置为中间

## 2-5 Vim快速增产改查

### Vim增加字符

- 进入插入模式

- 使用a/i/o进入插入模式

### Vim快速删除

如何快速删除一个字符或者单词?

- Vim在Normal模式下使用x快速删除一个字符

- 使用d（delete）配合文本对象快速删除一个单词daw（d around word），diw（删除一行，不包括空白字符）

- dd删除一行，`dt(`快速删除括号里的内容

- d$快速删除到行尾，d0快速删除到行首

- d和x都可以搭配数字来执行多次

- 使用v可以选择删除

### Vim快速修改

- 常用有三个，r（replace），c（change），s（substitute）

- Normal模式下使用r可以替换一个字符。s替换并进入插入模式

- R不断替换，Esc退出，S删除整行并进入插入模式

- 使用c配合文本对象，我们可以快速修改，cw删除单词插入，ct"删除引号中的内容

### Vim查询

- 使用/或者？进行前向或者反向搜索

- 使用n/N跳转到下一个或上一个匹配

- 使用*或者#进行当前单词的前向和后项匹配

## 2-6 vim如何搜索替换

### vim替换命令

substitute命令允许我们查找并且替换掉文本，并且支持正则表达式

- `:[range]s[ubstiute]/{pattern}/{string}/[flags]`

- range表示范围比如:10,20表示10-20行，%表示全部

- pattern要替换的模式，string是替换后的文本

#### 替换标志位

flags有几个常用的标志

- g（global）表示全局范围内执行

- c（confirm）表示确认，可以确认或者拒绝

- n（number)报告匹配到的次数而不替换，可以用来查询匹配次数

## 2-7 vim多文件操作

### Buffer，Window，Tab

- Buffer是指打开的一个文件的内存缓冲区

- 窗口是Buffer可视化的分割区域

- Tab可以组织窗口位一个工作区

#### Buffer

#####Buffer-什么是缓冲区？

- vim打开一个文件后会加载文件内容到缓冲区

- 之后的修改都是针对内存着的缓冲区，并不会直接保存到文件

- 直到我们执行:w（write）的时候才会把修改内容写入到文件里

##### Buffer切换

- 使用:ls会列举当前缓冲区，然后使用:b n跳的第n个缓冲区

- :bpre :bnext :bfirst :blast

- 或者用:b buffer_name加上tab补全来跳转

#### Window窗口

窗口是可视化的分割区域

- 一个缓冲区可以分割成多个窗口，每个窗口也可以打开不同缓冲区

- <Ctrl+w>s水平分割，<Ctrl+w>v垂直分割。或者:sp和:vs

- 每个窗口可以继续无限分割

|命令|用途|

|---|---|

|<Ctrl-w>w|在窗口键来回切换|

|h|切换到左边窗口|

|j|切换到下边窗口|

|k|切换到上边窗口|

|l|切换到右边窗口|

大写时可以移动窗口

#### Tab（标签页）将窗口分组

Tab是可以容纳一系列窗口的容器（:h tabpage)

- vim 的Tab和其他编辑器不太一样，可以想象成Linux的虚拟桌面

- 比如一个Tab全用来编辑Python文件，一个Tab全是HTML文件

- 相比窗口，Tab一般用的比较少，Tab太多，管理起来也太麻烦

## 2-8 什么是vim的text object

### Text Object（文本对象）

- vim里文本也有对象的概念，比如一个单词，一段句子，一个段落

- 很多其他编辑器经常只能操作单个字符来修改文本，比较低效

- 通过操作文本对象来修改要比只操作单字符高效

 ### 文本对象操作方式

- `[number]<command>[text object]`

- number 表示次数，command是命令，d（delete），c（change），y（yank）

- text object是操作的文本对象，比如单词w，句子s，段落p

## 2-9 vim复制粘贴与寄存器的使用

### vim在Normal模式复制粘贴

- Normal模式下复制粘贴分别使用y（yank）和p（put），剪切d和p

- 可以使用v（visual）命令选中所要复制的地方，然后顺遂p粘贴

- 配合文本对象：比如顺遂yiw复制一个单词，yy复制一

### Insert模式下的复制粘贴

- 和其他文本编辑器差不多，但粘贴代码有个坑

- 在vimrc中设置了autoindent，粘贴Python代码缩进错乱

- 这个时候需要使用`:set paste`和`:setnopaste`解决

### 什么是vim的寄存器

- vim里操作的是寄存器而不是系统剪切版，这和其他编辑器不同

- 默认使用d删除或者y复制的内容都放到了“无名寄存器”

- 用x删除一个字符放到无名寄存器，然后p粘贴，可以调换俩字符

### 深入寄存器（register）

- 通过`"{register}`前缀可以指定寄存器，不指定默认无名寄存器

- 比如使用`"ayiw`复制一个单词到寄存器a中，'bdd删除当前行到寄存器b中

- :reg a查看寄存器a中的内容

- "a p粘贴a寄存器中的内容

### 其他常见寄存器

除了有名的寄存器a-z，vim中还有一些其他常见寄存器

- 复制专用寄存器`"0`使用y复制的文本同时会被考呗到复制寄存器0

- 系统剪切版`"+`可以复制到系统剪切版

- 其他寄存器，比如`"%`当前文件名，`".`上次插入的文本

- :set clipboard=unnamed可以让你直接复制粘贴系统剪切版内容

## 2-10 vim宏（macro）

### 从需求说起

批量处理文本

### 什么是vim宏（macro）

- 宏可以看成是一系列命令的集合

- 我们可以使用宏【录制】一系列操作，然后用于回放

- 宏可以方便的把一下列命令用在多行文本上

### 如何使用宏

- vim使用q来录制，同时也也是q结束录制

- 使用q{register}选择要保存的寄存器，把录制的命令保存其中

- 使用@{register}回放寄存器中保存的一系列命令

### 用宏解决刚才的问题

- 献给一行加上双引号，让后在回放到其他行

- 我们先使用q开始录制，给一行加上双引号，之后使用q退出

- 在剩下的所有行中回放录制的宏

## 2-11 vim补全大法

### 什么是补全

- 补全是根据当前环境上下文有编辑器【猜】你想输入的东西

- 比如补全一个单词、文件名、或者代码中的函数名、变量名

- vim中提供了多种补全功能，还有由插件拓展功能实现代码补全

### vim中常见的补全

vim中有很多种补全方式

| 命令   | 补全类型   |
| ------ | ---------- |
| \<C-n> | 补全关键字 |
|\<C-x>\<C-n>|当前缓冲区关键字|
|\<C-x>\<C-i>|包含文件关键字|
|\<C-x>\<C-j>|标签关键字|
|\<C-x>\<C-k>|字典查找|
|\<C-x>\<C-l>|整行补全|
|\<C-x>\<C-f>|文件名补全|
|\<C-x><C-0>|全能（Omin）补全|

### 常见的三种补全类型

- 使用Ctrl+n和Ctrl+p补全单词

- 使用Ctrl+x，Ctrl+f补全文件名

- 使用Ctrl+x，Ctrl+o补全代码，需要开启文件类型检查，安装插件

## 2-12 给vimhr个配色

### vim更换配色

- 使用:colorscheme显示当前主题配色，默认是default

- 用:colorscheme <ctrl+d>可以显示所有配色

- 中意的配色后，用:colorscheme 配色名就可以修改配色

## 2-13 裸的vim

- 很多初学者Vim基本命令都不熟就开始找一些复杂的强大配置

- 不利于你熟悉Vim，一旦出问题了你还不知道怎么修复

- 建议初学者还是从裸的Vim开始学习,有些场景比如服务器或者容器上我们没法配置Vim

学之前，先用对打字指法和盲打

- 编辑代码,脑子- -般比手快,盲打有利于跟上你的大脑速度

- 裸的Vim也有很多强大功能和使用方式,本章你应该学到了不少

- 学会了用Vim ,你可以在你的IDE.上安装Vim插件,几乎所有流行的编辑器和IDE工具都支持Vim插件
