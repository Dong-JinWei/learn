# 第八章 CPU的结构和功能

## 一、CPU的结构

### 1.1、CPU的功能

1. 控制器的功能
   - 取指令
   - 分析指令
   - 执行指令， 发出各种操做命令
   - 控制程序输入及结果的输出
   - 总线管理
   - 处理异常情况和特殊情况
2. 运算器的功能
   - 实现算数运算和逻辑运算

可以总结为：指令控制，操作控制，时间控制，处理中断，数据加工

### 1.2、CPU 结构框图

![image-20220525142947660](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525142947660.png)

### 1.3、CPU的寄存器

<img src="8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525143057061.png" alt="image-20220525143057061" style="zoom:50%;" />

![image-20220525143357270](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525143357270.png)

### 1.4、控制单元 CU 和中断系统

![image-20220525143649594](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525143649594.png)

## 二、指令周期

### 2.1、指令周期的基本概念

![image-20220525144022349](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525144022349.png)

![image-20220525144229248](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525144229248.png)

![image-20220525144456897](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525144456897.png)

![image-20220525144555427](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525144555427.png)

![image-20220525144855510](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525144855510.png)

### 2.2、指令周期的数据流

![image-20220525145208968](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525145208968.png)

![image-20220525145402800](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525145402800.png)

![image-20220525145752897](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525145752897.png)

## 三、指令流水

### 3.1、如何提高机器速度

![image-20220525150210865](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525150210865.png)

### 3.2、系统的并行性

![image-20220525150423413](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525150423413.png)

### 3.3、指令流水原理

![image-20220525150807612](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525150807612.png)

![image-20220525150833411](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525150833411.png)

![image-20220525151254561](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525151254561.png)



### 3.3、影响指令流水线性能的因素

![image-20220525151433002](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525151433002.png)

![image-20220525151833614](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525151833614.png)



![image-20220525152330038](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525152330038.png)

![image-20220525152354246](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525152354246.png)

![image-20220525152531235](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525152531235.png)

### 3.4、流水线的性能

![image-20220525152658800](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525152658800.png)

![image-20220525152951222](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525152951222.png)

![image-20220525153114877](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525153114877.png)

![image-20220525153307702](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525153307702.png)

### 3.5、流水线的多发技术

![image-20220525153340630](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525153340630.png)

![image-20220525153431563](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525153431563.png)

![image-20220525153609239](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525153609239.png)

### 3.6、流水线结构

![image-20220525153652482](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525153652482.png)

![image-20220525153706961](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525153706961.png)



## 四、中断系统

### 4.1、概述

![image-20220525161648188](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525161648188.png)

![image-20220525161710964](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525161710964.png)

### 4.2、中断请求标记和中断判优逻辑

![image-20220525161929539](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525161929539.png)

![image-20220525162147564](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525162147564.png)

![image-20220525162214518](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525162214518.png)

### 4.3、中断服务程序入口地址寻址

![image-20220525162305490](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525162305490.png)

![image-20220525162444777](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525162444777.png)

### 4.4、中断响应

![image-20220525162620391](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525162620391.png)

![image-20220525162806508](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525162806508.png)

### 4.5、保护现场和恢复现场

<img src="8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525163514786.png" alt="image-20220525163514786" style="zoom:50%;" />

### 4.6、多重中断

![image-20220525163757640](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525163757640.png)

![image-20220525163827931](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525163827931.png)

![image-20220525163933625](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525163933625.png)

![image-20220525164031368](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525164031368.png)

![image-20220525164042168](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525164042168.png)

![image-20220525164051683](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525164051683.png)

![image-20220525164059693](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525164059693.png)

![image-20220525164117592](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525164117592.png)

![image-20220525164129642](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525164129642.png)

![image-20220525164139727](http://rca6dkxg8.hb-bkt.clouddn.com/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/8%E3%80%81CPU%E7%9A%84%E7%BB%93%E6%9E%84%E5%92%8C%E5%8A%9F%E8%83%BD/image-20220525164139727.png)